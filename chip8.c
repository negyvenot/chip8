#include <stdio.h>
#include <stdint.h>
#include <string.h>
#include <stdlib.h>

#define FONT_LOCATION 0x50
#define RAM_SIZE 4096
#define PGM_START 0x200
#define PGM_SIZE RAM_SIZE-PGM_START
#define STACK_SIZE 16

uint8_t mem[RAM_SIZE]; // main memory
uint8_t display[64][32];
uint16_t pc; // program counter
uint16_t i; // index register
uint16_t stack[STACK_SIZE];
uint8_t sp; // stack pointer
uint8_t dt; // delay timer
uint8_t st; // sound timer
uint16_t v[16]; // variable register

uint8_t font[] = {
 0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
 0x20, 0x60, 0x20, 0x20, 0x70, // 1
 0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
 0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
 0x90, 0x90, 0xF0, 0x10, 0x10, // 4
 0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
 0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
 0xF0, 0x10, 0x20, 0x40, 0x40, // 7
 0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
 0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
 0xF0, 0x90, 0xF0, 0x90, 0x90, // A
 0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
 0xF0, 0x80, 0x80, 0x80, 0xF0, // C
 0xE0, 0x90, 0x90, 0x90, 0xE0, // D
 0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
 0xF0, 0x80, 0xF0, 0x80, 0x80  // F
};

void init() {
 FILE *fp;
 int bytes_read;
 char *fname="chip8.ch8";

 memcpy(&mem[FONT_LOCATION], font, sizeof(font));
 sp = 0;

 fp=fopen(fname, "rb");
 if(!fp) {
  perror("fopen");
  exit(EXIT_FAILURE);
 }
 bytes_read=fread(&mem[PGM_START], 1, PGM_SIZE, fp);
 printf("%d\n", bytes_read);
 if(!feof(fp)) {
  printf("file too big\n");
  exit(1);
 }
 fclose(fp);
}

int main() {
 init();
// printf("%x\n", mem[FONT_LOCATION]);
 return 0;
}
